--use p8g4;

--CREATE SCHEMA COMPANY;
--go

/* Para apagar as tables
DROP TABLE COMPANY.WORKS_ON;
DROP TABLE COMPANY.PROJECT;
DROP TABLE COMPANY.DEPT_LOCATION;
DROP TABLE COMPANY.[DEPENDENT];
DROP TABLE COMPANY.DEPARTMENT;
DROP TABLE COMPANY.EMPLOYEE;
*/

/*
CREATE TABLE COMPANY.EMPLOYEE(
	Fname		VARCHAR(15) NOT NULL,
	Minit		CHAR,
	Lname		VARCHAR(15) NOT NULL,
	Ssn			CHAR(9)		NOT NULL,
	Bdate		DATE,
	[Address]	VARCHAR(30),
	Sex			CHAR,
	Salary		DECIMAL(10,2),
	Super_ssn	CHAR(9),
	Dno			INT,
	PRIMARY KEY (Ssn),
	FOREIGN KEY (Super_ssn) REFERENCES COMPANY.EMPLOYEE(Ssn),
);


CREATE TABLE COMPANY.DEPARTMENT(
	Dname	VARCHAR(15) NOT NULL,
	Dnumber	INT			NOT NULL,
	Mgr_ssn	CHAR(9),
	Mgr_start_date	DATE,
	PRIMARY KEY(Dnumber),
	UNIQUE (Dname),
	FOREIGN KEY (Mgr_ssn) REFERENCES COMPANY.EMPLOYEE (Ssn)
);

ALTER TABLE COMPANY.EMPLOYEE
ADD CONSTRAINT EMPDEPTFK FOREIGN KEY (Dno) REFERENCES COMPANY.DEPARTMENT(Dnumber);
*/

CREATE TABLE COMPANY.[DEPENDENT] (
	Essn			CHAR(9)		NOT NULL,
	Dependent_name	VARCHAR(15) NOT NULL,
	Sex				CHAR,
	Bdate			DATE,
	Relationship	VARCHAR(8),
	PRIMARY KEY (Essn, Dependent_name),
	FOREIGN KEY (Essn) REFERENCES COMPANY.EMPLOYEE(Ssn)
);

CREATE TABLE COMPANY.DEPT_LOCATION(
	Dnumber		INT			NOT NULL,
	Dlocation	VARCHAR(15)	NOT NULL,
	PRIMARY KEY (Dnumber, Dlocation),
	FOREIGN KEY (Dnumber) REFERENCES COMPANY.DEPARTMENT(Dnumber)
);

CREATE TABLE COMPANY.PROJECT(
	Pname		VARCHAR(15)	NOT NULL,
	Pnumber		INT			NOT NULL,
	Plocation	VARCHAR(15),
	Dnum		INT			NOT NULL,
	PRIMARY KEY (Pnumber),
	UNIQUE (Pname),
	FOREIGN KEY (Dnum) REFERENCES COMPANY.DEPARTMENT(Dnumber)
);

CREATE TABLE COMPANY.WORKS_ON(
	Essn	CHAR(9)			NOT NULL,
	Pno		INT				NOT NULL,
	[Hours]	DECIMAL(3,1)	NOT NULL,
	PRIMARY KEY (Essn, Pno),
	FOREIGN KEY (Essn) REFERENCES COMPANY.EMPLOYEE(Ssn),
	FOREIGN KEY (Pno) REFERENCES COMPANY.PROJECT(Pnumber)
);


-- Inserir a data
/*
INSERT INTO COMPANY.EMPLOYEE VALUES
('Carlos','D','Gomes','21312332' ,'2000-01-01','Rua XPTO','M',1200.00,NULL,NULL),
('Juliana','A','Amaral','321233765','1980-08-11','Rua BZZZZ','F',1350.00,NULL,NULL),
('Maria','I','Pereira','342343434','2001-05-01','Rua JANOTA','F',1250.00,21312332,NULL),
('Joao','G','Costa','41124234' ,'2001-01-01','Rua YGZ','M',1300.00,21312332,NULL),
('Ana','L','Silva','12652121' ,'1990-03-03','Rua ZIG ZAG','F',1400.00,21312332,NULL),
('Paula','A','Sousa','183623612','2001-08-11','Rua da FRENTE','F',1450.00,NULL,NULL);

INSERT INTO COMPANY.DEPARTMENT VALUES
('RecursosHumanos',4,'12652121','2014-04-02'),
('Investigacao',1,'21312332' ,'2010-08-02'),
('Desporto',5,NULL,NULL),
('Comercial',2,'321233765','2013-05-16'),
('Logistica',3,'41124234' ,'2013-05-16');
*/

INSERT INTO COMPANY.[DEPENDENT] VALUES
('21312332 ','Joana Costa','F','2008-04-01', 'Filho'),
('21312332 ','Maria Costa','F','1990-10-05', 'Neto'),
('21312332 ','Rui Costa','M','2000-08-04','Neto'),
('321233765','Filho Lindo','M','2001-02-22','Filho'),
('342343434','Rosa Lima','F','2006-03-11','Filho'),
('41124234 ','Ana Sousa','F','2007-04-13','Neto'),
('41124234 ','Gaspar Pinto','M','2006-02-08','Sobrinho');

INSERT INTO COMPANY.DEPT_LOCATION VALUES
(2,'AVEIRO'),
(3,'COIMBRA');

INSERT INTO COMPANY.PROJECT VALUES
('Aveiro Digital', 1, 'Aveiro', 3),
('BD Open Day', 2, 'Espinho', 2),
('Dicoogle', 3, 'Aveiro', 4),
('GOPACS', 4, 'Aveiro', 3);

INSERT INTO COMPANY.WORKS_ON VALUES
('183623612',1,20.0),
('183623612',3,10.0),
('21312332 ',1,20.0),
('321233765',1,25.0),
('342343434',1,20.0),
('342343434',4,25.0),
('41124234 ',2,20.0),
('41124234 ',3,30.0);

UPDATE COMPANY.EMPLOYEE
SET Dno=3
WHERE Ssn='183623612';

UPDATE COMPANY.EMPLOYEE
SET Dno=1
WHERE Ssn='21312332 ';

UPDATE COMPANY.EMPLOYEE
SET Dno=3
WHERE Ssn='321233765';

UPDATE COMPANY.EMPLOYEE
SET Dno=2
WHERE Ssn='342343434';

UPDATE COMPANY.EMPLOYEE
SET Dno=2
WHERE Ssn='41124234 ';

UPDATE COMPANY.EMPLOYEE
SET Dno=2
WHERE Ssn='12652121 ';